[{"id":0,"href":"/workshop-learn-github-actions/workshop/preamble/","title":"Preamble","section":"Workshop","content":" Preamble # Before you dive into the workshop, there are a few basic things it may help to understand\nNext About GitHub Actions # YAML, YAML, and more YAML # GitHub Actions relies heavily on YAML for defining the work to be done.\nSome basic yaml features that will help you understand the files in this workshop\na: yaml object: uses colons: to separate keys and values list-descr: - a - yaml - list - uses hypens to separate items list-of-objects: - a: yaml list: of objects - uses: hypens to: start new objects list-of-objects: - a: yaml list: of objects - uses: hypens to: start new objects Back Next Basic Architecture # A repository On Github GitHub Codespaces to edit code GitHub Actions for CICD GitHub hosted runners Github Pages for web hosting Back Next About Hugo - The generator for this site # GitHub Actions (our CICD) and GitHub Pages (our hosting platorm) don\u0026rsquo;t require you to use any particular language or tool. But this specific workshop is built on the wonderful, open-source Hugo static site generator and the hugo-book theme.\nBack Next "},{"id":1,"href":"/workshop-learn-github-actions/workshop/1-create-repo/","title":"1 - Create the Repository","section":"Workshop","content":" Create the Repository # First, you will need to create a new repository on GitHub. This repository will be used to store the code for the workshop and will be the repository which will run all the GitHub Actions and Workflows.\nWe are going to make a new repository using the GitHub web interface.\nInstructions # Open up the New Repository Page and fill it out with these suggested settings:\nTemplate: No Template Owner: Your GitHub User Name: workshop-learn-github-actions This can be the same for everyone since it is namespaced under your user Visibility: Public GitHub Actions are availabile to both public and private repositories, Each repository gets a number of free \u0026ldquo;minutes\u0026rdquo; of action time per month. But, we will be using GitHub Pages to serve the static assets, which will require the repository to be public. Everything else can be left unchecked. We will be bootstraping the contents of the repo in a later step\nBack Next Bootstrap The Repository Contents # Open the respository in GitHub Click the Code button Click the \u0026ldquo;Codespaces tab\u0026rdquo; Click \u0026ldquo;Create codespace on main\u0026rdquo; Wait for the page to load Use the terminal to download and extract the assets for the workshop curl https://carsonoid.github.io/workshop-learn-github-actions/workshop-assets.tgz | tar -zxv Alternatively, you can click here download the assets then right click in the file explorer and choose \u0026ldquo;Upload\u0026rdquo;, then run tar -zxvf workshop-assets.tgz Back Next Run the site live # The default codespace image comes with hugo pre-installed, but it does not have some features required by this site, so we need to install the extended edition:\ncurl -L https://github.com/gohugoio/hugo/releases/download/v0.134.3/hugo_extended_0.145.0_linux-amd64.tar.gz | tar -zxv hugo Then run the version we installed:\n./hugo server @carsonoid ➜ /workspaces/workshop-learn-github-actions (main) $ hugo server Watching for changes in /workspaces/workshop-learn-github-actions/{content,data,layouts,static,themes} Watching for config changes in /workspaces/workshop-learn-github-actions/config.toml Start building sites … hugo v0.124.1-db083b05f16c945fec04f745f0ca8640560cf1ec linux/amd64 BuildDate=2024-03-20T11:40:10Z VendorInfo=gohugoio | EN -------------------+----- Pages | 18 Paginator pages | 0 Non-page files | 3 Static files | 78 Processed images | 0 Aliases | 2 Cleaned | 0 Built in 52 ms Environment: \u0026#34;development\u0026#34; Serving pages from disk Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender Web Server is available at //localhost:1313/ (bind address 127.0.0.1) Press Ctrl+C to stop You can even view the site by selecting \u0026ldquo;open in browser\u0026rdquo; when codespace pops up.\nBack Next Build the site # Runing hugo server builds the site for local viewing, but it does not build production-ready assets. To do that, simply run hugo without any arguments.\n./hugo @carsonoid ➜ /workspaces/workshop-learn-github-actions (main) $ hugo Start building sites … hugo v0.124.1-db083b05f16c945fec04f745f0ca8640560cf1ec linux/amd64 BuildDate=2024-03-20T11:40:10Z VendorInfo=gohugoio | EN -------------------+----- Pages | 18 Paginator pages | 0 Non-page files | 3 Static files | 78 Processed images | 0 Aliases | 2 Cleaned | 0 Total in 101 ms Success! Now we have a public directory inside the codespace that contains all the static web assets needed to serve our site.\nBack Next "},{"id":2,"href":"/workshop-learn-github-actions/workshop/2-introduction/1-steps/","title":"1 - Steps","section":"2 - Introducing GitHub Actions","content":" Steps # Steps are the basic building block for jobs. These are the actual actions part of GitHub Actions. They are essentially a task that you need done. This could be a task that uses code in the repository, but it does not have to be. A step could essentially do anything.\nThink of steps as analogous to `functions` in code. They are a logical grouping of behaviors. Examples # Basic # A very basic example of a step might be to fetch the code for the current repo.\n- name: Checkout uses: actions/checkout@v3 Steps may have configuration, the format and specifics of the configuration are dependent on action being used.\n- name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 Steps may also be as simple as running a script:\n- name: Build run: hugo --minify Complex scripts may use the yaml multiline syntax to provide\n- name: Build run: | echo \u0026#34;doing thing\u0026#34; date sleep 1 echo \u0026#34;done\u0026#34; Back Next "},{"id":3,"href":"/workshop-learn-github-actions/workshop/","title":"Workshop","section":"Introduction","content":" Workshop: Learning GitHub Actions # What you need # A GitHub account Internet access This is a fully-online workshop, even the code editing will be done via browser What you do not need # While you might normally use the following tools, the workshop is designed to not require them.\nA git client installed on your machine We will be using GitHub to do git operations You can use a git client and clone the repository to your local machine if you prefer A code editor We will be using the GitHub vscode web editor You can use a local editor if you prefer, but the workshop will use GitHub Codespaces Next GitHub Primer # The only requirement to do this workshop is a GitHub account. If you do not have one, it is easy and free to sign up.\nGitHub Actions Pricing # This workshop requires you to use GitHub Actions. This is a service provided by GitHub and as such may or may not have a cost associated with it depending on your usage.\nThis workshop we have you make a public repository and contains very short workflows. This means that there should be no cost associated with doing this workshop. As long as you make your repository public then usage of GitHub actions is free to a point. But please reference the Billing Documentation for information on the cost associated with using GitHub Actions in private repositories and free usage limitations.\nGitHub Codespaces Pricing # For speed and ease of use, this workshop is built around GitHub Codespaces. Whenever possible, it contains alternate instructions that do not require Codespaces. This is a service provided by GitHub and comes with limitations and a potential cost\nYou do not have to use Codespaces in order to use GitHub Actions! This is done in the workshop purely for minimal attendee setup. Free accounts get 120 hours per month which is much, much less time then is required to complete this workshop. Each user gets a limited number of free Codespace hours per month. Be sure to stop or delete codespaces when you are done so you do not waste usage hours with an idle codespace. If you do not manually stop, the codespace will timout after a set duration (default 30 minutes) so the maximum wasted time is 1/2 hour if you do not manually exit a space. See the Billing Documentation for more information on the free tier or added costs.\nBack Next Next "},{"id":4,"href":"/workshop-learn-github-actions/workshop/2-introduction/","title":"2 - Introducing GitHub Actions","section":"Workshop","content":" Where We are # By now you should have a new repository and Codespace running, this workspace includes all the assets for this workshop. However, you can\u0026rsquo;t view the workshop without running hugo in your Codespace and accessing a port forward.\nWhat We Want # A new publically available website for the workshop based on your repo Automatic builds of the workshop for commits to ensure that PRs never merge if they break builds Automatic publishing changes that have been merged into main to the public website. What We Don\u0026rsquo;t Want # To have to install anything locally To have to have any servers to maintain To have to pay anything for our tiny little personal project Next Introducing GitHub Actions # Thankfully, GitHub Actions can give us everything we need. But before we start writing yaml files we need to understand the fundamental building blocks of GitHub Actions.\nThe yaml snippets below are simplified to help understand the main building-blocks of GitHub Actions. They will not work if copied directly. Back Next Runners # Back Next Steps # Steps are the smallest building blocks of GitHub Actions. They are defined in yaml and can be as simple as executing a single command or as complex as running a nested series of steps.\nA simple yaml definition for a \u0026ldquo;Build\u0026rdquo; step might look like this:\nname: Build run: hugo Back Next Jobs # Jobs are collections of one or more steps that should be run in sequence.\nAll the steps in a job are run on the same host without any automatic cleanup between them. This is fundamentally different from many other CI/CD systems\nA simple yaml definition for a Build job containing our Build step might look like this:\nname: Build runs-on: ubuntu-20.04 steps: - name: Build run: hugo Notice the Build step from is now nested in the steps list\nBack Next Workflows # Workflows are collections of one or more jobs that should be potentially executed using the same trigger conditions.\nname: CI/CD on: push # The trigger conditions jobs: build: name: Build runs-on: ubuntu-20.04 steps: - name: Build run: hugo Notice the Build job from is now nested in the jobs list\nBack Next "},{"id":5,"href":"/workshop-learn-github-actions/workshop/2-introduction/2-jobs/","title":"2 - Jobs","section":"2 - Introducing GitHub Actions","content":" Jobs # In GitHub Actions, jobs represent a series of steps that are executed in order. Important things to know about jobs:\nJobs must run on a single runner Jobs have a workspace which persists between steps Jobs can trigger other jobs Jobs must be defined inside a workflow Back Next "},{"id":6,"href":"/workshop-learn-github-actions/workshop/3-first-workflow/","title":"3 - First Workflow","section":"Workshop","content":" First Workflow # Once you have the bootstrapped repository and workshop content from the Create Repo Page you are ready to create your first GitHub Actions Workflow!\nThe general overview of this workflow:\nRun on push to the repository Contains a single job which should Clone the repo Install hugo Build the site (sometimes) Publish the site to GitHub Pages There are many, many more fields that are valid for workflows, jobs, and steps then we will cover here. [See the docs for all the options](https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions) Back Next Create the workflow # Defining a workflow with GitHub actions is easy as making a file! Do the following inside your code space:\nmkdir -p .github/workflows touch .github/workflows/cicd.yaml Or\nRight Click in the explorer and click \u0026ldquo;New File\u0026rdquo; and type .github/workflows/cicd.yaml\n**The folder names matter** The file name for a workflow file can by anything. But it *must* be in a directory at the root of the repo that exactly matches the name `.github/workflows` for the file to be discovered. Back Next Setup the workflow name and trigger # Here is the start to our new workflow:\nname: CI/CD on: push jobs: The name field is optional and can be whatever you want. But it will be used in the GitHub UI in many places so a short human-friendly name is best. The on field is where you define the conditions under which your workflow runs. We will just use on: push to have the workflow trigger whenver any commits or tags are pushed. The jobs field is where all jobs are defined, it is empty for now but we will add the first job in the next step Back Next Setup the build job # name: CI/CD on: push jobs: build: name: Build runs-on: ubuntu-20.04 permissions: contents: write steps: The jobs field of the workflow is a map of job ids to job descriptions. We have defined a single job with the id of build\nThe name field is used to give our job a more human-readable name The runs-on field is required. It tells the actions information about the kind of runner the job needs. We are using ubuntu-20.04 which is a GitHub Hosted Runner. There are many other kinds of runner, including custom runners (not covered in this workshop) The permissions field defines custom permissions this workflow will need on our repo. This field is optional and the default is normally only contents: write. This workflow is going to need to push the static site content to a branch of the repository, so we need to give it extra permissions. The steps field is empty for now, but we will put all our job steps there in the next section. Back Next Add the checkout step # name: CI/CD on: push jobs: build: name: Build runs-on: ubuntu-20.04 permissions: contents: write steps: - name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 Remember: Each job starts with an empty workspace. So, if we want to build our static web site from the workshop code, we need to first clone the repository from GitHub.\nWe can do this with the actions/checkout action which is an offical action provided and maintained by GitHub directly.\nThings to note about this action:\nIt references a github repository by name using the uses field It is pinned to a specific tag in the by using the @ sign in the action names. This is required, GitHub actions does not have an automatic \u0026ldquo;latest\u0026rdquo; tag for actions. (this is a good thing!) TODO HERE Back Next Add the hugo install step # name: CI/CD on: push jobs: build: name: Build runs-on: ubuntu-20.04 permissions: contents: write steps: - name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 - name: Setup Hugo uses: peaceiris/actions-hugo@v3 with: hugo-version: \u0026#39;latest\u0026#39; extended: true Back Next Add the build step # name: CI/CD on: push jobs: build: name: Build runs-on: ubuntu-20.04 permissions: contents: write steps: - name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 - name: Setup Hugo uses: peaceiris/actions-hugo@v3 with: hugo-version: \u0026#39;latest\u0026#39; extended: true - name: Build run: hugo --minify Back Next Add the deploy step # name: CI/CD on: push jobs: build: name: Build runs-on: ubuntu-20.04 permissions: contents: write steps: - name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 - name: Setup Hugo uses: peaceiris/actions-hugo@v3 with: hugo-version: \u0026#39;latest\u0026#39; extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public cname: guts-of-git.carson-anderson.com Back Next Full Final Workflow # name: CI/CD on: push jobs: build: if : github.ref == \u0026#39;refs/heads/main\u0026#39; name: Build runs-on: ubuntu-20.04 permissions: contents: write steps: - name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 - name: Setup Hugo uses: peaceiris/actions-hugo@v3 with: hugo-version: \u0026#39;latest\u0026#39; extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public cname: guts-of-git.carson-anderson.com Back Next Now run it! # Because our workflow is set up to trigger on push all we have to do to kick it off is to simply create a new commit and push it to GitHub.\ngit checkout -b init git add . git commit -m \u0026#34;feat: initial add\u0026#34; git push -u origin HEAD Ok\u0026hellip; now what? We pushed the update but how do we know if it is working?\nBack Next Watching a workflow # Luckily, GitHub provides a very useful UI to help us track workflows and check the status of the jobs. It can be found under the Actions tab on the repository\u0026rsquo;s GitHub page.\nBack Next "},{"id":7,"href":"/workshop-learn-github-actions/workshop/2-introduction/3-workflows/","title":"3 - Workflows","section":"2 - Introducing GitHub Actions","content":" Workflows # In GitHub Actions, workflows are a colleciton of jobs. Important things to know about workflows\nWorkflows can define multiple jobs Workflows can be called many ways: By code change Manually By other workflows Workflows do not actually execute directly, they only define jobs which get executed Back Next "},{"id":8,"href":"/workshop-learn-github-actions/workshop/4-actions/","title":"4 - Actions","section":"Workshop","content":" Actions # At this point you should have public web page for the workshop built off your repository and hosted under your GitHub handle. This section of the workshop will\nbreak down the actions currently in the CI/CD workflow and job. guide you through two kinds of custom actions Back Next Current Actions # The CI/CD job currently has two kinds of actions defined\n3rd Party Actions Custom \u0026ldquo;shell\u0026rdquo; actions Back Next 3rd Party Actions # These are actions that are defined in other GitHub Repositories. They encapsulate a specific behavior or step and can often be very complex behind the scenes.\n- name: Checkout uses: actions/checkout@v3 with: submodules: true fetch-depth: 0 Back Next Custom \u0026ldquo;shell\u0026rdquo; actions # These are actions that are defined entirely in the workflow step itself. They run using the default shell of the runner unless shell is specified.\nIt is common to use yaml multiline strings to put relatively long scripts into the action directly.\n- name: Build run: | # there is no built-in env variable for the repo name without owner, so we have to parse it out REPO_NAME=$(echo \u0026#34;${GITHUB_REPOSITORY}\u0026#34; | cut -d\u0026#39;/\u0026#39; -f2) hugo --minify -b \u0026#34;https://${GITHUB_REPOSITORY_OWNER}.github.io/$REPO_NAME/\u0026#34; These kinds of actions are infinitely flexible but can be highly dependent on the runner and workflow environment. Shell scripting is also has a lot of potential pitfalls and easy mistakes that can be made.\nNever the less: it is a very common kind of action to use and is often \u0026ldquo;just enough\u0026rdquo; to get work done while incurring almost no overhead.\nBack Next New Actions # There are two more types of actions that can be very useful:\nComposite Actions Javascript Actions Docker Container Actions Back Next Composite Actions # Composite Actions are a way to combine one or more other actions into a single unit. They are often used to automate complex behaviors into a more streamlined interface.\nCreating and using a new Composite Action locally is as easy as creating a new directory and writing an action.yaml file.\nBuild it # To define a new custom composite action: create a new file at .github/actions/build/action.yaml with the content below. You might notice that this we are simply moving the Setup Hugo and Build steps from the original workflow. That is true, but we have now made our own \u0026ldquo;build\u0026rdquo; abstraction that is easier to re-use and simplifies the main workflow.\nname: \u0026#39;Build\u0026#39; description: \u0026#39;Build the workshop web assets\u0026#39; runs: using: \u0026#34;composite\u0026#34; steps: - name: Setup Hugo uses: peaceiris/actions-hugo@v3 with: hugo-version: \u0026#39;latest\u0026#39; extended: true - name: Build shell: bash run: | # there is no built-in env variable for the repo name without owner, so we have to parse it out REPO_NAME=$(echo \u0026#34;${GITHUB_REPOSITORY}\u0026#34; | cut -d\u0026#39;/\u0026#39; -f2) hugo --minify -b \u0026#34;https://${GITHUB_REPOSITORY_OWNER}.github.io/$REPO_NAME/\u0026#34; Back Next Use it # Then reference it in a job by using a local path reference after checkout.\nYou can simply remove the old Setup Hugo and Build steps from .github/workflows/ci-cd.yaml and replace them with the new action.\n- name: Build uses: ./.github/actions/build You might notice that using a custom action is a lot like using a 3rd party action. That's because 3rd party actions are simply custom actions that have been given dedicated repositories. All 3rd party actions that you use are either composite actions or javascript actions that are simply hosted in a dedicated repository instead of a directory in your own repository. Back Next Javascript Actions # Back Next Docker Container Actions # Back "},{"id":9,"href":"/workshop-learn-github-actions/credits/","title":"Credits","section":"Introduction","content":" Credits # A big thank you to everyone who has contributed to the enhancement and proliferation of this workshop and the ecosystem that supports it.\nArtist # Debbi Humrich\nIf you like the artwork and would like to commission your own you can contact Debbie at TODO\nSite Credits # GitHub Actions Hugo hugo-book theme Authors Carson Anderson "}]